{"ast":null,"code":"import _assertThisInitialized from\"/home/james/Documents/Coding Projects/Math.Sound/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/james/Documents/Coding Projects/Math.Sound/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/james/Documents/Coding Projects/Math.Sound/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _createClass from\"/home/james/Documents/Coding Projects/Math.Sound/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _classCallCheck from\"/home/james/Documents/Coding Projects/Math.Sound/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import React from'react';import'./App.css';import{derivative,parse}from'mathjs';import ReactSlider from'react-slider';import{create,all}from'mathjs';import{Col,Container,ListGroup,Row,Nav,Form,Accordion,InputGroup,Button,Card}from'react-bootstrap';//#region Graph Actions\nvar graphCanvas;var graphContext;var math=require('mathjs');var Instruments=require('webaudio-instruments');var restrictedMath=create(all);var restrictedEvaluate=restrictedMath.evaluate;restrictedMath.import({'import':function _import(){return;},'createUnit':function createUnit(){return;},'evaluate':function evaluate(){return;},'parse':function parse(){return;},'simplify':function simplify(){return;},'derivative':function derivative(){return;}},{override:true});var graphObject={// main object, with all graphCanvas manipulation methods\nSetup:function Setup(){this.plotsPerScreen=400;//TODO allow this to change for different processor strengths\nthis.numGrids=20;// number of grid markings\nthis.scaleColour=\"#000D34\";graphContext.lineJoin=\"round\";if(window.innerWidth<992){this.WindowSizeChange(document.getElementById('graphwrapper').getBoundingClientRect().width,window.innerHeight*0.5);}else{this.WindowSizeChange(window.innerWidth*0.65,window.innerHeight);}},WindowSizeChange:function WindowSizeChange(width,height){graphCanvas.width=width;graphCanvas.height=height;timingCanvas.width=width;timingCanvas.height=height;this.upperLimitX=graphCanvas.width/2;this.lowerLimitX=-graphCanvas.width/2;this.upperLimitY=graphCanvas.height/2;this.lowerLimitY=-graphCanvas.height/2;this.pointInterval=graphCanvas.width/this.plotsPerScreen;// changes for balance of smoothness of line with time to compute, decrease with more zoom increase with less zoom, by default 1000 plots per screen\ngraphContext.setTransform(1,0,0,-1,graphCanvas.width/2,graphCanvas.height/2);// inverts y-axis in order to increase as you move further up as in the cartesian plane\nthis.fontSize=10;this.functionWidth=\"0.5\";this.minorScaleWidth=\"0.1\";this.zoomRatio=1;// each pixel equals one unit at the start\ntimingContext.lineWidth=2;timingContext.strokeStyle=\"#56DACC\";this.ChangeDefaultScaling();this.GraphCalculator();},ChangeDefaultScaling:function ChangeDefaultScaling(){if(this.lowerLimitX<-1000||this.upperLimitX>1000){this.Scale(2000/(Math.abs(this.upperLimitX)+Math.abs(this.lowerLimitX)));}},ExpressionValidifier:function ExpressionValidifier(exprText,idIndex){// checks expression before making calculations to avoid wasting resources\nvar exprObject;try{// first test is to try and parse the expression\nexprObject=parse(exprText);}catch(_unused){return false;}// second test is to see if all variables are x\nvar symbolNodes=exprObject.filter(function(node){return node.isSymbolNode;});var operatorNodes=exprObject.filter(function(node){return node.isOperatorNode;});var functionNodes=exprObject.filter(function(node){return node.isFunctionNode;});// since symbolnodes are used for variables and functions, we must check that all symbolnodes are\n// either x or a function, also check that no operation is done that has a symbolnode that is not x\nfor(var i=0;i<functionNodes.length;i++){if(functionNodes[i].args.length<1){return false;}}if(symbolNodes.length>0){for(var _i=0;_i<symbolNodes.length;_i++){if(symbolNodes[_i].name==='x'||symbolNodes[_i].name in math){}else{return false;}}for(var _i2=0;_i2<operatorNodes.length;_i2++){// check that no operation is done with non x symbolnode, otherwise tan * 4 etc would break it\nif(operatorNodes[_i2].isBinary()){if(operatorNodes[_i2].args[0].isSymbolNode&&operatorNodes[_i2].args[0].name!=='x'){return false;}if(operatorNodes[_i2].args[1].isSymbolNode&&operatorNodes[_i2].args[1].name!=='x'){return false;}}if(operatorNodes[_i2].isUnary()){// protests from x! as no negative factorials allowed\nif(operatorNodes[_i2].args[0].isSymbolNode){return false;}}}}//tests passed, expression valid\n// get the derivative as well and add it as a property\ntry{graphObject.expressions[idIndex].derivative=derivative(exprObject,\"x\").toString();}catch(_unused2){}return true;},calculate:function calculate(input,expression){var scope={x:input};return restrictedEvaluate(expression,scope);},GraphCalculator:function GraphCalculator(){// drawing your own graphs \nthis.ClearAll();this.DrawAxes();var curGradient;var prevGradient;var curY;var prevY;var prevPointInterval=this.pointInterval;graphContext.lineWidth=graphObject.functionWidth;for(var z=0;z<this.expressions.length;z++){var curExpression=this.expressions[z].expr;var curDerivative=this.expressions[z].derivative;if(this.expressions[z].validity===true){graphContext.beginPath();graphContext.strokeStyle=this.expressions[z].colour;graphContext.moveTo(this.expressions[z].domain[0],this.calculate(this.expressions[z].domain[0],curExpression));var lowerLimitOfLoop=void 0;var upperLimitOfLoop=void 0;if(this.expressions[z].domain[0]>this.lowerLimitX){// checks if domain or edge of canvas is closer and sets it to the limits of the loop\nlowerLimitOfLoop=this.expressions[z].domain[0];}else{lowerLimitOfLoop=this.lowerLimitX;}if(this.expressions[z].domain[1]<this.upperLimitX){upperLimitOfLoop=this.expressions[z].domain[1];}else{upperLimitOfLoop=this.upperLimitX;}for(var i=lowerLimitOfLoop;i<upperLimitOfLoop;i+=this.pointInterval){curY=this.calculate(i,curExpression);curGradient=this.calculate(i,curDerivative);if(Math.sign(curGradient)===-1&&Math.sign(prevGradient)===-1&&curY>prevY){graphContext.lineTo(i,-10000);graphContext.stroke();graphContext.beginPath();graphContext.moveTo(i+0.001,10000);}else if(Math.sign(curGradient)===1&&Math.sign(prevGradient)===1&&curY<prevY){graphContext.lineTo(i,10000);graphContext.stroke();graphContext.beginPath();graphContext.moveTo(i+0.001,-10000);}else{graphContext.lineTo(i,curY);}prevY=curY;prevGradient=curGradient;}graphContext.stroke();this.pointInterval=prevPointInterval;}}},Scale:function Scale(ratio){if(this.upperLimitX*ratio>1000){ratio=1000/this.upperLimitX;}if(this.lowerLimitX*ratio<-1000){ratio=-1000/this.lowerLimitX;}this.pointInterval*=ratio;this.zoomRatio*=ratio;this.fontSize*=ratio;graphContext.scale(1/ratio,1/ratio);this.lowerLimitX*=ratio;this.upperLimitX*=ratio;this.lowerLimitY*=ratio;this.upperLimitY*=ratio;this.functionWidth*=ratio;this.minorScaleWidth*=ratio;this.GraphCalculator();},ClearAll:function ClearAll(){graphContext.save();graphContext.setTransform(1,0,0,1,0,0);graphContext.clearRect(0,0,graphCanvas.width,graphCanvas.height);graphContext.fillStyle=\"white\";graphContext.fillRect(0,0,graphCanvas.width,graphCanvas.height);graphContext.restore();},DrawAxes:function DrawAxes(){graphContext.beginPath();// axes\ngraphContext.strokeStyle=graphObject.scaleColour;graphContext.lineWidth=graphObject.functionWidth;graphContext.moveTo(this.lowerLimitX,0);graphContext.lineTo(this.upperLimitX,0);graphContext.moveTo(0,this.upperLimitY);graphContext.lineTo(0,this.lowerLimitY);graphContext.stroke();var roundedlowerLimitX=Math.floor(this.lowerLimitX/1000)*1000;// setup for minor axes\nvar roundedupperLimitX=Math.ceil(this.upperLimitX/1000)*1000;var roundedlowerLimitY=Math.floor(this.lowerLimitY/1000)*1000;var roundedupperLimitY=Math.ceil(this.upperLimitY/1000)*1000;graphContext.font=this.fontSize+'px sans-serif';graphContext.fillStyle=graphObject.scaleColour;graphContext.lineWidth=graphObject.minorScaleWidth;for(var x=roundedlowerLimitX;x<roundedupperLimitX;x+=100){// minor axes\ngraphContext.moveTo(x,this.upperLimitY);graphContext.lineTo(x,this.lowerLimitY);}for(var y=roundedlowerLimitY;y<roundedupperLimitY;y+=100){graphContext.moveTo(this.lowerLimitX,y);graphContext.lineTo(this.upperLimitX,y);}graphContext.stroke();graphContext.save();graphContext.scale(1,-1);for(var _x=roundedlowerLimitX;_x<roundedupperLimitX;_x+=100){// numbering\ngraphContext.fillText(_x,_x,-1);}for(var _y=roundedlowerLimitY;_y<roundedupperLimitY;_y+=100){// numbering\ngraphContext.fillText(_y,1,-_y);}graphContext.restore();},ShiftGraph:function ShiftGraph(shiftByX,shiftByY){shiftByX*=this.zoomRatio;shiftByY*=this.zoomRatio;if(this.upperLimitX-shiftByX>1000){shiftByX=0;}if(this.lowerLimitX-shiftByX<-1000){shiftByX=0;}graphContext.transform(1,0,0,1,shiftByX,shiftByY);this.upperLimitX-=shiftByX;this.lowerLimitX-=shiftByX;this.upperLimitY-=shiftByY;this.lowerLimitY-=shiftByY;this.GraphCalculator();}};var expressionConstructor=function expressionConstructor(expr,domain,colour){_classCallCheck(this,expressionConstructor);this.expr=expr;this.domain=domain;this.colour=colour;};//#endregion\n//#region Timing graph\nvar timingCanvas;var timingContext;var timingGraphObject={Setup:function Setup(){this.beatsPerScreen=8+1;// one less than true\nthis.timeBetweenBeats=1000;// in milliseconds\nthis.beat=1;this.audioSources=[new audioSource()];// default first instrument/graph\nthis.timer=0;this.audioSourcesToPlay=[];this.CalculateNextNote();},CalculateNextNote:function CalculateNextNote(){var _this=this;this.timer=setTimeout(function(){_this.MoveTimerBarAndPlay();},this.timeBetweenBeats);if(this.beat>=this.beatsPerScreen){this.beat=1;}this.beat++;var timerBarPosition=Math.round(graphObject.lowerLimitX+(graphObject.upperLimitX-graphObject.lowerLimitX)/this.beatsPerScreen*this.beat);for(var i=0;i<this.audioSources.length;i++){if(graphObject.expressions[i].validity===true&&timerBarPosition>=graphObject.expressions[i].domain[0]&&timerBarPosition<=graphObject.expressions[i].domain[1]&&this.audioSources[i].muteToggle===false){var newFreq=graphObject.calculate(timerBarPosition,graphObject.expressions[i].expr);this.audioSourcesToPlay.push(this.audioSources[i]);if(newFreq<=-12000){this.audioSources[i].changeFrequency(-12000);}else if(newFreq>=12000){this.audioSources[i].changeFrequency(12000);}else if(isNaN(newFreq)===false){this.audioSources[i].changeFrequency(newFreq);}}}},MoveTimerBarAndPlay:function MoveTimerBarAndPlay(){timingContext.clearRect(0,0,graphCanvas.width,graphCanvas.height);timingContext.beginPath();timingContext.moveTo(graphCanvas.width/this.beatsPerScreen*this.beat,0);timingContext.lineTo(graphCanvas.width/this.beatsPerScreen*this.beat,graphCanvas.height);timingContext.stroke();for(var i=0;i<this.audioSourcesToPlay.length;i++){timingGraphObject.audioSourcesToPlay[i].play();}this.audioSourcesToPlay=[];this.CalculateNextNote();}};//#endregion\n//#region Audio\nvar instrumentList=new Instruments().names.splice(0,127);var audioSource=/*#__PURE__*/function(){function audioSource(){_classCallCheck(this,audioSource);this.instrumentNumber=0;// default\nthis.frequency=0;this.player=new Instruments();this.muteToggle=false;}_createClass(audioSource,[{key:\"play\",value:function play(){if(this.muteToggle===false){this.player.play(this.instrumentNumber,this.frequency,1,0,0.5);}}},{key:\"changeFrequency\",value:function changeFrequency(newFreq){this.frequency=Math.abs(newFreq);}},{key:\"changeMuteToggle\",value:function changeMuteToggle(newVal){this.muteToggle=newVal;}},{key:\"changeInstrument\",value:function changeInstrument(newInstrumentNumber){this.instrumentNumber=newInstrumentNumber;}}]);return audioSource;}();//#endregion\n//#region React components\nvar AllInputs=/*#__PURE__*/function(_React$Component){_inherits(AllInputs,_React$Component);var _super=_createSuper(AllInputs);function AllInputs(){var _this2;_classCallCheck(this,AllInputs);_this2=_super.call(this);_this2.state={components:[0]};_this2.IDCount=0;_this2.possibleColourArray=[\"#2F2980\",\"#0476D9\",\"#56DACC\",\"#8C186D\",\"#F23535\",\"#ffffff\"];_this2.lastColourPicked=0;return _this2;}_createClass(AllInputs,[{key:\"create\",value:function create(){var prevState=this.state.components;this.IDCount++;prevState.push(this.IDCount);graphObject.expressions.push(new expressionConstructor(\"\",[-1000,1000],this.possibleColourArray[this.lastColourPicked]));if(this.lastColourPicked===4){this.lastColourPicked=0;}else{this.lastColourPicked++;}timingGraphObject.audioSources.push(new audioSource());this.setState({components:prevState});}},{key:\"delete\",value:function _delete(id){var prevState=this.state.components;var idIndex=prevState.findIndex(function(el){return el===id;});prevState.splice(idIndex,1);graphObject.expressions.splice(idIndex,1);timingGraphObject.audioSources.splice(idIndex,1);this.setState({components:prevState});graphObject.GraphCalculator();}},{key:\"changeInstrument\",value:function changeInstrument(id,newInstrumentNumber){var idIndex=this.state.components.findIndex(function(el){return el===id;});timingGraphObject.audioSources[idIndex].changeInstrument(newInstrumentNumber);}},{key:\"changeDomain\",value:function changeDomain(id,newValue){var idIndex=this.state.components.findIndex(function(el){return el===id;});graphObject.expressions[idIndex].domain=newValue;graphObject.GraphCalculator();}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(InputBox,{components:this.state.components,deleteFunction:this.delete.bind(this),createFunction:this.create.bind(this),changeInstrumentFunction:this.changeInstrument.bind(this),changeDomainFunction:this.changeDomain.bind(this)});}}]);return AllInputs;}(React.Component);var InputBox=/*#__PURE__*/function(_React$Component2){_inherits(InputBox,_React$Component2);var _super2=_createSuper(InputBox);// where we type in the function and clear\nfunction InputBox(props){var _this3;_classCallCheck(this,InputBox);_this3=_super2.call(this,props);_this3.handleChangeDomain=_this3.handleChangeDomain.bind(_assertThisInitialized(_this3));_this3.handleCreate=_this3.handleCreate.bind(_assertThisInitialized(_this3));_this3.handleDeleteFunction=_this3.handleDelete.bind(_assertThisInitialized(_this3));return _this3;}_createClass(InputBox,[{key:\"handleCreate\",value:function handleCreate(id){this.props.createFunction(id);}},{key:\"handleDelete\",value:function handleDelete(id){this.props.deleteFunction(id);}},{key:\"handleChangeDomain\",value:function handleChangeDomain(id,newValue){this.props.changeDomainFunction(id,newValue);}},{key:\"render\",value:function render(){var _this4=this;return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(ListGroup,null,this.props.components.map(function(comp){return/*#__PURE__*/React.createElement(ListGroup.Item,{className:\"ListGroupItem\",key:comp},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Input,{components:_this4.props.components,id:comp,deleteFunction:_this4.handleDeleteFunction}),/*#__PURE__*/React.createElement(ReactSlider,{defaultValue:[-1000,1000],max:1000,min:-1000,renderThumb:function renderThumb(props,state){return/*#__PURE__*/React.createElement(\"div\",props,state.valueNow);},onAfterChange:function onAfterChange(val){_this4.handleChangeDomain(comp,val);},className:\"horizontal-slider-twohandle\",thumbClassName:\"sliderThumbTwoHandle\",trackClassName:\"sliderTrack\",pearling:true}),/*#__PURE__*/React.createElement(InstrumentChooser,{id:comp,changeInstrumentFunction:_this4.props.changeInstrumentFunction})));})),/*#__PURE__*/React.createElement(Button,{className:\"newFunctionButton\",variant:\"dark\",onClick:this.handleCreate.bind(this)},/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-plus\",\"aria-hidden\":\"true\"})),/*#__PURE__*/React.createElement(Accordion,{className:\"HelpAccordion\"},/*#__PURE__*/React.createElement(Card,null,/*#__PURE__*/React.createElement(Card.Header,null,/*#__PURE__*/React.createElement(Accordion.Toggle,{as:Button,variant:\"dark\",eventKey:\"0\",className:\"HelpButton\"},\"About\")),/*#__PURE__*/React.createElement(Accordion.Collapse,{eventKey:\"0\"},/*#__PURE__*/React.createElement(Card.Body,null,\"To make sounds, enter in any function with x as the only variable, like sin(x)*50 or x^3+x+24 or 400/x. A sound will be made where the vertical counting bar crosses any function.\",/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),\"The frequency of the sound will be the y value of the intersection of the function and vertical bar, this means that higher values will work better e.g sin(x)*50 rather than sin(x). The Beats Per Screen slider at the top of screen amount of times the vertical bar will occur per screen. The Time Per Beat slider controls the time between the vertical bar moving. You can adjust the domain of the function with its slider below it, along with its instrument. You can add as many functions as you like, click the plus button to create a new one, and the x button to delete one graph.\",/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(\"br\",null),\"Just play around with it! Pick whatever instrument sounds interesting, fiddle around with the sliders and make something that sounds cool!\",/*#__PURE__*/React.createElement(\"br\",null))))));}}]);return InputBox;}(React.Component);var InstrumentChooser=/*#__PURE__*/function(_React$Component3){_inherits(InstrumentChooser,_React$Component3);var _super3=_createSuper(InstrumentChooser);function InstrumentChooser(props){var _this5;_classCallCheck(this,InstrumentChooser);_this5=_super3.call(this,props);_this5.handleChange=_this5.handleChange.bind(_assertThisInitialized(_this5));return _this5;}_createClass(InstrumentChooser,[{key:\"handleChange\",value:function handleChange(){var newAudioType=document.getElementById(this.props.id+\"audioType\").value;this.props.changeInstrumentFunction(this.props.id,newAudioType);}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(Form.Control,{as:\"select\",onChange:this.handleChange,id:this.props.id+\"audioType\"},instrumentList.map(function(name,index){return/*#__PURE__*/React.createElement(\"option\",{key:index,value:index},name);}));}}]);return InstrumentChooser;}(React.Component);var Input=/*#__PURE__*/function(_React$Component4){_inherits(Input,_React$Component4);var _super4=_createSuper(Input);function Input(props){var _this6;_classCallCheck(this,Input);_this6=_super4.call(this,props);_this6.state={text:\"\"};_this6.handleChange=_this6.handleChange.bind(_assertThisInitialized(_this6));_this6.idIndex=_this6.props.components.findIndex(function(el){return el===_this6.props.id;});_this6.colour=graphObject.expressions[_this6.idIndex].colour;_this6.validity=false;return _this6;}_createClass(Input,[{key:\"handleChange\",value:function handleChange(e){var _this7=this;this.idIndex=this.props.components.findIndex(function(el){return el===_this7.props.id;});this.setState({text:e.target.value});graphObject.expressions[this.idIndex].expr=e.target.value.toLowerCase();graphObject.expressions[this.idIndex].validity=false;this.validity=false;if(e.target.value===\"\"){graphObject.expressions[this.idIndex].expr=\"\";graphObject.expressions[this.idIndex].validity=false;this.validity=false;graphObject.GraphCalculator();}else if(graphObject.ExpressionValidifier(graphObject.expressions[this.idIndex].expr,this.idIndex)===true){graphObject.expressions[this.idIndex].validity=true;this.validity=true;graphObject.GraphCalculator();}}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(InputGroup,null,/*#__PURE__*/React.createElement(InputGroup.Prepend,null,/*#__PURE__*/React.createElement(InputGroup.Text,{className:\"colourIndicator\",style:{backgroundColor:this.colour}},\" \")),/*#__PURE__*/React.createElement(Form.Control,{className:\"Input\",isInvalid:!this.validity,placeholder:\"Enter function e.g 3x + 70\",type:\"text\",value:this.state.text,onChange:this.handleChange}),/*#__PURE__*/React.createElement(MuteButton,{id:this.props.id,components:this.props.components}),/*#__PURE__*/React.createElement(DeleteButton,{id:this.props.id,deleteFunction:this.props.deleteFunction}));}}]);return Input;}(React.Component);var DeleteButton=/*#__PURE__*/function(_React$Component5){_inherits(DeleteButton,_React$Component5);var _super5=_createSuper(DeleteButton);function DeleteButton(props){var _this8;_classCallCheck(this,DeleteButton);_this8=_super5.call(this,props);_this8.handleClick=_this8.handleClick.bind(_assertThisInitialized(_this8));return _this8;}_createClass(DeleteButton,[{key:\"handleClick\",value:function handleClick(){this.props.deleteFunction(this.props.id);}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(InputGroup.Append,null,/*#__PURE__*/React.createElement(Button,{variant:\"outline-dark\",onClick:this.handleClick},/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-times\",\"aria-hidden\":\"true\"})));}}]);return DeleteButton;}(React.Component);var MuteButton=/*#__PURE__*/function(_React$Component6){_inherits(MuteButton,_React$Component6);var _super6=_createSuper(MuteButton);function MuteButton(props){var _this9;_classCallCheck(this,MuteButton);_this9=_super6.call(this,props);_this9.handleChange=_this9.handleChange.bind(_assertThisInitialized(_this9));_this9.state={iconToShow:\"fas fa-volume-up\",isMuted:false};return _this9;}_createClass(MuteButton,[{key:\"handleChange\",value:function handleChange(){var _this10=this;var idIndex=this.props.components.findIndex(function(el){return el===_this10.props.id;});if(this.state.isMuted===true){timingGraphObject.audioSources[idIndex].changeMuteToggle(false);// not muted\nthis.setState({iconToShow:\"fas fa-volume-up\",isMuted:false});}else{timingGraphObject.audioSources[idIndex].changeMuteToggle(true);// muted\nthis.setState({iconToShow:\"fas fa-volume-mute\",isMuted:true});}}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(InputGroup.Append,null,/*#__PURE__*/React.createElement(Button,{variant:\"outline-dark\",onClick:this.handleChange},/*#__PURE__*/React.createElement(\"i\",{className:this.state.iconToShow})));}}]);return MuteButton;}(React.Component);var BPS=/*#__PURE__*/function(_React$Component7){_inherits(BPS,_React$Component7);var _super7=_createSuper(BPS);function BPS(){var _this11;_classCallCheck(this,BPS);_this11=_super7.call(this);_this11.handleChangeBPS=_this11.handleChangeBPS.bind(_assertThisInitialized(_this11));_this11.state={value:50};return _this11;}_createClass(BPS,[{key:\"handleChangeBPS\",value:function handleChangeBPS(newVal){this.setState({value:newVal});timingGraphObject.beatsPerScreen=newVal;}},{key:\"render\",value:function render(){var _this12=this;return/*#__PURE__*/React.createElement(Form,null,/*#__PURE__*/React.createElement(Form.Group,{className:\"Slider\"},/*#__PURE__*/React.createElement(Form.Label,{className:\"label\"},\"Beats Per Screen\"),/*#__PURE__*/React.createElement(ReactSlider,{defaultValue:this.state.value,max:100,min:1,renderThumb:function renderThumb(props,state){return/*#__PURE__*/React.createElement(\"div\",props,state.value);},onChange:function onChange(val){_this12.handleChangeBPS(val);},className:\"horizontal-slider-onehandle\",thumbClassName:\"sliderThumb\",trackClassName:\"sliderTrack\"})));}}]);return BPS;}(React.Component);var TBB=/*#__PURE__*/function(_React$Component8){_inherits(TBB,_React$Component8);var _super8=_createSuper(TBB);function TBB(){var _this13;_classCallCheck(this,TBB);_this13=_super8.call(this);_this13.handleChangeTBB=_this13.handleChangeTBB.bind(_assertThisInitialized(_this13));_this13.state={value:500};return _this13;}_createClass(TBB,[{key:\"handleChangeTBB\",value:function handleChangeTBB(newVal){this.setState({value:newVal});timingGraphObject.timeBetweenBeats=newVal;}},{key:\"render\",value:function render(){var _this14=this;return/*#__PURE__*/React.createElement(Form,null,/*#__PURE__*/React.createElement(Form.Group,{className:\"Slider\"},/*#__PURE__*/React.createElement(Form.Label,{className:\"label\"},\"Time Between Beats\"),/*#__PURE__*/React.createElement(ReactSlider,{defaultValue:this.state.value,max:1000,min:100,renderThumb:function renderThumb(props,state){return/*#__PURE__*/React.createElement(\"div\",props,state.value/1000+\"s\");},onChange:function onChange(val){_this14.handleChangeTBB(val);},className:\"horizontal-slider-onehandle\",step:100,thumbClassName:\"sliderThumb\",trackClassName:\"sliderTrack\"})));}}]);return TBB;}(React.Component);var Graphs=/*#__PURE__*/function(_React$Component9){_inherits(Graphs,_React$Component9);var _super9=_createSuper(Graphs);function Graphs(props){var _this15;_classCallCheck(this,Graphs);_this15=_super9.call(this,props);_this15.graphCanvasRef=React.createRef();_this15.timingCanvasRef=React.createRef();_this15.windowWidth=window.innerWidth;_this15.dragCoords={x:0,y:0};_this15.pointerEventArray=[];_this15.prevPointDist=-1;_this15.dragging=false;_this15.timesPerSecond=60;_this15.waiting=false;_this15.handleMouseDown=_this15.handleMouseDown.bind(_assertThisInitialized(_this15));_this15.handleMouseMove=_this15.handleMouseMove.bind(_assertThisInitialized(_this15));_this15.handleMouseUp=_this15.handleMouseUp.bind(_assertThisInitialized(_this15));_this15.handleMouseOut=_this15.handleMouseOut.bind(_assertThisInitialized(_this15));_this15.handleWheel=_this15.handleWheel.bind(_assertThisInitialized(_this15));_this15.handleResize=_this15.handleResize.bind(_assertThisInitialized(_this15));_this15.handleMouseEnter=_this15.handleMouseEnter.bind(_assertThisInitialized(_this15));return _this15;}_createClass(Graphs,[{key:\"componentDidMount\",value:function componentDidMount(){graphCanvas=this.graphCanvasRef.current;graphContext=this.graphCanvasRef.current.getContext('2d');timingCanvas=this.timingCanvasRef.current;timingContext=this.timingCanvasRef.current.getContext('2d');window.addEventListener(\"resize\",this.handleResize);}},{key:\"preventDefault\",value:function preventDefault(e){e.returnValue=false;}},{key:\"handleMouseEnter\",value:function handleMouseEnter(){document.addEventListener('wheel',this.preventDefault,{passive:false});}},{key:\"handleMouseDown\",value:function handleMouseDown(e){e.persist();this.pointerEventArray.push(e);this.dragging=true;this.dragCoords={x:e.clientX,y:e.clientY};}},{key:\"handleMouseMove\",value:function handleMouseMove(e){if(this.waiting===false&&this.dragging===true){// throttling\ne.persist();for(var i=0;i<this.pointerEventArray.length;i++){// for handling a pinch gesture\nif(e.pointerId===this.pointerEventArray[i].pointerId){this.pointerEventArray[i]=e;break;}}if(this.pointerEventArray.length===2){var curPointDist=Math.hypot(this.pointerEventArray[0].clientX-this.pointerEventArray[1].clientX,this.pointerEventArray[0].clientY-this.pointerEventArray[1].clientY);if(this.prevPointDist>0){if(curPointDist>this.prevPointDist){graphObject.Scale(0.9);}else if(curPointDist<this.prevPointDist){graphObject.Scale(1.1);}}this.prevPointDist=curPointDist;return;}if(this.dragging===true){graphObject.ShiftGraph(e.clientX-this.dragCoords.x,this.dragCoords.y-e.clientY);this.dragCoords={x:e.clientX,y:e.clientY};}this.waiting=true;setTimeout(function(){this.waiting=false;}.bind(this),1000/this.timesPerSecond);}}},{key:\"handleMouseUp\",value:function handleMouseUp(e){e.persist();this.pointerEventArray=[];for(var i=0;i<this.pointerEventArray.length;i++){if(this.pointerEventArray[i].pointerId===e.pointerId){this.pointerEventArray.splice(i,1);break;}}if(this.pointerEventArray.length<2){this.prevPointDist=-1;}this.dragging=false;}},{key:\"handleMouseOut\",value:function handleMouseOut(){this.dragging=false;document.removeEventListener('wheel',this.preventDefault,false);}},{key:\"handleWheel\",value:function handleWheel(e){if(e.deltaY<0){// Zoom in\ngraphObject.Scale(0.9);}else{// Zoom out\ngraphObject.Scale(1.1);}}},{key:\"handleResize\",value:function handleResize(){if(window.innerWidth!==this.windowWidth){// makes resize only happen for width changes\nthis.windowWidth=window.innerWidth;if(window.innerWidth<992){// if the window less than lg breakpoint\ngraphObject.WindowSizeChange(document.getElementById('graphwrapper').getBoundingClientRect().width,window.innerHeight*0.5);}else{graphObject.WindowSizeChange(window.innerWidth*0.65,window.innerHeight);}}}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"canvas\",{ref:this.graphCanvasRef,onPointerDown:this.handleMouseDown,onPointerMove:this.handleMouseMove,onPointerUp:this.handleMouseUp,onPointerOut:this.handleMouseOut,onWheel:this.handleWheel,onPointerEnter:this.handleMouseEnter,className:\"graphCanvas\"},\" \"),/*#__PURE__*/React.createElement(\"canvas\",{ref:this.timingCanvasRef,className:\"timingCanvas\"}));}}]);return Graphs;}(React.Component);var App=/*#__PURE__*/function(_React$PureComponent){_inherits(App,_React$PureComponent);var _super10=_createSuper(App);function App(props){var _this16;_classCallCheck(this,App);_this16=_super10.call(this,props);graphObject.expressions=[new expressionConstructor(\"0\",[-1000,1000],\"#000000\")];// array of objects that gets all info about a certain expression colour, value and domains.\n// initialised here so component in charge of displaying colour will know what's going on\nreturn _this16;}_createClass(App,[{key:\"componentDidMount\",value:function componentDidMount(){graphObject.Setup();graphObject.DrawAxes();timingGraphObject.Setup();}},{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Container,{fluid:true,className:\"bg\"},/*#__PURE__*/React.createElement(Nav,{fill:true,className:\"topbar \"},/*#__PURE__*/React.createElement(Nav.Item,null,/*#__PURE__*/React.createElement(BPS,null)),/*#__PURE__*/React.createElement(Nav.Item,null,/*#__PURE__*/React.createElement(TBB,null))),/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{xs:12,lg:{span:4,order:'first'}},/*#__PURE__*/React.createElement(AllInputs,null)),/*#__PURE__*/React.createElement(Col,{xs:{span:12,order:'first'},lg:8,className:\"graphColumn\"},/*#__PURE__*/React.createElement(\"div\",{id:\"graphwrapper\"},/*#__PURE__*/React.createElement(Graphs,null))))));}}]);return App;}(React.PureComponent);//#endregion\nexport default App;","map":{"version":3,"sources":["/home/james/Documents/Coding Projects/Math.Sound/src/App.js"],"names":["React","derivative","parse","ReactSlider","create","all","Col","Container","ListGroup","Row","Nav","Form","Accordion","InputGroup","Button","Card","graphCanvas","graphContext","math","require","Instruments","restrictedMath","restrictedEvaluate","evaluate","import","override","graphObject","Setup","plotsPerScreen","numGrids","scaleColour","lineJoin","window","innerWidth","WindowSizeChange","document","getElementById","getBoundingClientRect","width","innerHeight","height","timingCanvas","upperLimitX","lowerLimitX","upperLimitY","lowerLimitY","pointInterval","setTransform","fontSize","functionWidth","minorScaleWidth","zoomRatio","timingContext","lineWidth","strokeStyle","ChangeDefaultScaling","GraphCalculator","Scale","Math","abs","ExpressionValidifier","exprText","idIndex","exprObject","symbolNodes","filter","node","isSymbolNode","operatorNodes","isOperatorNode","functionNodes","isFunctionNode","i","length","args","name","isBinary","isUnary","expressions","toString","calculate","input","expression","scope","x","ClearAll","DrawAxes","curGradient","prevGradient","curY","prevY","prevPointInterval","z","curExpression","expr","curDerivative","validity","beginPath","colour","moveTo","domain","lowerLimitOfLoop","upperLimitOfLoop","sign","lineTo","stroke","ratio","scale","save","clearRect","fillStyle","fillRect","restore","roundedlowerLimitX","floor","roundedupperLimitX","ceil","roundedlowerLimitY","roundedupperLimitY","font","y","fillText","ShiftGraph","shiftByX","shiftByY","transform","expressionConstructor","timingGraphObject","beatsPerScreen","timeBetweenBeats","beat","audioSources","audioSource","timer","audioSourcesToPlay","CalculateNextNote","setTimeout","MoveTimerBarAndPlay","timerBarPosition","round","muteToggle","newFreq","push","changeFrequency","isNaN","play","instrumentList","names","splice","instrumentNumber","frequency","player","newVal","newInstrumentNumber","AllInputs","state","components","IDCount","possibleColourArray","lastColourPicked","prevState","setState","id","findIndex","el","changeInstrument","newValue","delete","bind","changeDomain","Component","InputBox","props","handleChangeDomain","handleCreate","handleDeleteFunction","handleDelete","createFunction","deleteFunction","changeDomainFunction","map","comp","valueNow","val","changeInstrumentFunction","InstrumentChooser","handleChange","newAudioType","value","index","Input","text","e","target","toLowerCase","backgroundColor","DeleteButton","handleClick","MuteButton","iconToShow","isMuted","changeMuteToggle","BPS","handleChangeBPS","TBB","handleChangeTBB","Graphs","graphCanvasRef","createRef","timingCanvasRef","windowWidth","dragCoords","pointerEventArray","prevPointDist","dragging","timesPerSecond","waiting","handleMouseDown","handleMouseMove","handleMouseUp","handleMouseOut","handleWheel","handleResize","handleMouseEnter","current","getContext","addEventListener","returnValue","preventDefault","passive","persist","clientX","clientY","pointerId","curPointDist","hypot","removeEventListener","deltaY","App","span","order","PureComponent"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport { derivative, parse } from 'mathjs';\nimport ReactSlider from 'react-slider';\nimport { create, all } from 'mathjs';\nimport { Col, Container, ListGroup, Row, Nav, Form, Accordion, InputGroup, Button, Card } from 'react-bootstrap';\n\n//#region Graph Actions\n\nlet graphCanvas;\nlet graphContext;\n\n\nconst math = require('mathjs');\nconst Instruments = require('webaudio-instruments');\nconst restrictedMath = create(all)\nconst restrictedEvaluate = restrictedMath.evaluate;\nrestrictedMath.import({\n  'import': function () { return },\n  'createUnit': function () { return },\n  'evaluate': function () { return },\n  'parse': function () { return },\n  'simplify': function () { return },\n  'derivative': function () { return },\n\n}, { override: true })\n\n\n\n\nlet graphObject = { // main object, with all graphCanvas manipulation methods\n\n  Setup: function () {\n\n\n    this.plotsPerScreen = 400; //TODO allow this to change for different processor strengths\n    this.numGrids = 20; // number of grid markings\n\n    this.scaleColour = \"#000D34\";\n\n    graphContext.lineJoin = \"round\";\n\n    if (window.innerWidth < 992) {\n      this.WindowSizeChange(document.getElementById('graphwrapper').getBoundingClientRect().width, window.innerHeight * 0.5);\n    }\n    else {\n      this.WindowSizeChange(window.innerWidth * 0.65, window.innerHeight);\n\n    }\n\n  },\n  WindowSizeChange: function (width, height) {\n    graphCanvas.width = width;\n    graphCanvas.height = height;\n    timingCanvas.width = width;\n    timingCanvas.height = height;\n\n    this.upperLimitX = graphCanvas.width / 2;\n    this.lowerLimitX = -graphCanvas.width / 2;\n    this.upperLimitY = graphCanvas.height / 2;\n    this.lowerLimitY = -graphCanvas.height / 2;\n    this.pointInterval = graphCanvas.width / this.plotsPerScreen; // changes for balance of smoothness of line with time to compute, decrease with more zoom increase with less zoom, by default 1000 plots per screen\n\n    graphContext.setTransform(1, 0, 0, -1, graphCanvas.width / 2, graphCanvas.height / 2); // inverts y-axis in order to increase as you move further up as in the cartesian plane\n    this.fontSize = 10;\n    this.functionWidth = \"0.5\";\n    this.minorScaleWidth = \"0.1\";\n    this.zoomRatio = 1; // each pixel equals one unit at the start\n    timingContext.lineWidth = 2;\n    timingContext.strokeStyle = \"#56DACC\";\n\n    this.ChangeDefaultScaling()\n\n    this.GraphCalculator();\n\n  },\n  ChangeDefaultScaling() {\n    if (this.lowerLimitX < -1000 || this.upperLimitX > 1000) {\n      this.Scale(2000 / (Math.abs(this.upperLimitX) + Math.abs(this.lowerLimitX)))\n\n    }\n\n  },\n  ExpressionValidifier(exprText, idIndex) { // checks expression before making calculations to avoid wasting resources\n    let exprObject;\n    try { // first test is to try and parse the expression\n      exprObject = parse(exprText)\n\n\n\n    } catch {\n      return false;\n    }\n    // second test is to see if all variables are x\n\n    let symbolNodes = exprObject.filter(function (node) {\n      return node.isSymbolNode\n    })\n    let operatorNodes = exprObject.filter(function (node) {\n      return node.isOperatorNode;\n    })\n    let functionNodes = exprObject.filter(function (node) {\n      return node.isFunctionNode;\n    })\n    // since symbolnodes are used for variables and functions, we must check that all symbolnodes are\n    // either x or a function, also check that no operation is done that has a symbolnode that is not x\n    for (let i = 0; i < functionNodes.length; i++) {\n      if (functionNodes[i].args.length < 1) {\n\n        return false;\n      }\n    }\n    if (symbolNodes.length > 0) {\n\n      for (let i = 0; i < symbolNodes.length; i++) {\n\n        if (symbolNodes[i].name === 'x' || symbolNodes[i].name in math) {\n\n\n        }\n        else {\n          return false;\n        }\n\n      }\n      for (let i = 0; i < operatorNodes.length; i++) { // check that no operation is done with non x symbolnode, otherwise tan * 4 etc would break it\n        if (operatorNodes[i].isBinary()) {\n          if (operatorNodes[i].args[0].isSymbolNode && operatorNodes[i].args[0].name !== 'x') {\n            return false;\n          }\n          if (operatorNodes[i].args[1].isSymbolNode && operatorNodes[i].args[1].name !== 'x') {\n            return false;\n          }\n        }\n        if (operatorNodes[i].isUnary()) { // protests from x! as no negative factorials allowed\n          if (operatorNodes[i].args[0].isSymbolNode) {\n\n            return false;\n          }\n\n        }\n\n      }\n\n    }\n\n\n    //tests passed, expression valid\n\n    // get the derivative as well and add it as a property\n\n    try {\n      graphObject.expressions[idIndex].derivative = derivative(exprObject, \"x\").toString();\n\n    }\n    catch {\n    }\n\n\n\n    return true\n\n\n  },\n\n  calculate: function (input, expression) {\n\n    const scope = {\n      x: input\n    }\n\n    return restrictedEvaluate(expression, scope);\n\n\n  }\n  ,\n\n  GraphCalculator: function () { // drawing your own graphs \n    this.ClearAll();\n    this.DrawAxes();\n\n    let curGradient;\n    let prevGradient;\n\n    let curY;\n    let prevY;\n\n    let prevPointInterval = this.pointInterval;\n    graphContext.lineWidth = graphObject.functionWidth;\n\n    for (let z = 0; z < this.expressions.length; z++) {\n\n      let curExpression = this.expressions[z].expr;\n      let curDerivative = this.expressions[z].derivative;\n      if (this.expressions[z].validity === true) {\n\n        graphContext.beginPath();\n        graphContext.strokeStyle = this.expressions[z].colour;\n        graphContext.moveTo(this.expressions[z].domain[0], this.calculate(this.expressions[z].domain[0], curExpression));\n\n        let lowerLimitOfLoop;\n        let upperLimitOfLoop;\n        if (this.expressions[z].domain[0] > this.lowerLimitX) { // checks if domain or edge of canvas is closer and sets it to the limits of the loop\n          lowerLimitOfLoop = this.expressions[z].domain[0];\n        } else {\n          lowerLimitOfLoop = this.lowerLimitX;\n        }\n        if (this.expressions[z].domain[1] < this.upperLimitX) {\n          upperLimitOfLoop = this.expressions[z].domain[1];\n        } else {\n          upperLimitOfLoop = this.upperLimitX;\n        }\n\n        for (let i = lowerLimitOfLoop; i < upperLimitOfLoop; i += this.pointInterval) {\n\n          curY = this.calculate(i, curExpression)\n          curGradient = this.calculate(i, curDerivative);\n\n          if (Math.sign(curGradient) === -1 && Math.sign(prevGradient) === -1 && curY > prevY) {\n            graphContext.lineTo(i, -10000);\n            graphContext.stroke();\n            graphContext.beginPath();\n            graphContext.moveTo(i + 0.001, 10000);\n          }\n          else if (Math.sign(curGradient) === 1 && Math.sign(prevGradient) === 1 && curY < prevY) {\n            graphContext.lineTo(i, 10000);\n            graphContext.stroke();\n            graphContext.beginPath();\n            graphContext.moveTo(i + 0.001, -10000);\n\n          }\n          else {\n            graphContext.lineTo(i, curY);\n\n          }\n\n\n          prevY = curY;\n          prevGradient = curGradient;\n\n\n\n\n        }\n\n        graphContext.stroke();\n        this.pointInterval = prevPointInterval;\n\n      }\n\n    }\n\n  },\n\n\n  Scale: function (ratio) {\n    if (this.upperLimitX * ratio > 1000) {\n      ratio = 1000 / this.upperLimitX\n    }\n    if (this.lowerLimitX * ratio < -1000) {\n      ratio = -1000 / this.lowerLimitX\n\n    }\n    this.pointInterval *= ratio;\n    this.zoomRatio *= ratio;\n    this.fontSize *= ratio;\n    graphContext.scale(1 / ratio, 1 / ratio);\n    this.lowerLimitX *= ratio;\n\n    this.upperLimitX *= ratio;\n    this.lowerLimitY *= ratio;\n    this.upperLimitY *= ratio;\n    this.functionWidth *= ratio;\n    this.minorScaleWidth *= ratio;\n    this.GraphCalculator();\n\n  },\n  ClearAll: function () {\n    graphContext.save();\n    graphContext.setTransform(1, 0, 0, 1, 0, 0);\n    graphContext.clearRect(0, 0, graphCanvas.width, graphCanvas.height);\n    graphContext.fillStyle = \"white\";\n    graphContext.fillRect(0, 0, graphCanvas.width, graphCanvas.height);\n    graphContext.restore();\n  },\n\n  DrawAxes: function () {\n\n    graphContext.beginPath(); // axes\n    graphContext.strokeStyle = graphObject.scaleColour;\n    graphContext.lineWidth = graphObject.functionWidth;\n\n    graphContext.moveTo(this.lowerLimitX, 0);\n    graphContext.lineTo(this.upperLimitX, 0);\n\n    graphContext.moveTo(0, this.upperLimitY);\n    graphContext.lineTo(0, this.lowerLimitY);\n\n    graphContext.stroke();\n\n\n    const roundedlowerLimitX = Math.floor(this.lowerLimitX / 1000) * 1000; // setup for minor axes\n    const roundedupperLimitX = Math.ceil(this.upperLimitX / 1000) * 1000;\n    const roundedlowerLimitY = Math.floor(this.lowerLimitY / 1000) * 1000;\n    const roundedupperLimitY = Math.ceil(this.upperLimitY / 1000) * 1000;\n\n\n    graphContext.font = this.fontSize + 'px sans-serif';\n    graphContext.fillStyle = graphObject.scaleColour;\n    graphContext.lineWidth = graphObject.minorScaleWidth;\n\n\n    for (let x = roundedlowerLimitX; x < roundedupperLimitX; x += 100) { // minor axes\n\n      graphContext.moveTo(x, this.upperLimitY);\n      graphContext.lineTo(x, this.lowerLimitY);\n\n\n    }\n\n    for (let y = roundedlowerLimitY; y < roundedupperLimitY; y += 100) {\n\n      graphContext.moveTo(this.lowerLimitX, y);\n      graphContext.lineTo(this.upperLimitX, y);\n\n    }\n\n    graphContext.stroke();\n\n    graphContext.save();\n    graphContext.scale(1, -1);\n\n\n    for (let x = roundedlowerLimitX; x < roundedupperLimitX; x += 100) { // numbering\n\n\n      graphContext.fillText(x, x, -1);\n\n    }\n\n    for (let y = roundedlowerLimitY; y < roundedupperLimitY; y += 100) { // numbering\n\n\n      graphContext.fillText(y, 1, -y);\n\n    }\n\n    graphContext.restore();\n\n\n  },\n  ShiftGraph: function (shiftByX, shiftByY) {\n\n    shiftByX *= this.zoomRatio;\n    shiftByY *= this.zoomRatio;\n    if (this.upperLimitX - shiftByX > 1000) {\n      shiftByX = 0\n    }\n    if (this.lowerLimitX - shiftByX < -1000) {\n      shiftByX = 0\n\n    }\n\n\n    graphContext.transform(1, 0, 0, 1, shiftByX, shiftByY);\n    this.upperLimitX -= shiftByX;\n    this.lowerLimitX -= shiftByX;\n    this.upperLimitY -= shiftByY;\n    this.lowerLimitY -= shiftByY;\n    this.GraphCalculator();\n\n\n  },\n\n\n}\n\nclass expressionConstructor {\n  constructor(expr, domain, colour) {\n    this.expr = expr;\n    this.domain = domain\n    this.colour = colour\n  }\n\n}\n//#endregion\n\n\n//#region Timing graph\nlet timingCanvas;\nlet timingContext;\n\n\nlet timingGraphObject = {\n  Setup: function () {\n\n\n    this.beatsPerScreen = 8 + 1; // one less than true\n    this.timeBetweenBeats = 1000; // in milliseconds\n    this.beat = 1;\n    this.audioSources = [new audioSource()]; // default first instrument/graph\n    this.timer = 0;\n    this.audioSourcesToPlay = [];\n    this.CalculateNextNote();\n\n\n  },\n  CalculateNextNote() {\n    this.timer = setTimeout(() => {\n      this.MoveTimerBarAndPlay();\n    }, this.timeBetweenBeats);\n\n\n    if (this.beat >= this.beatsPerScreen) {\n      this.beat = 1;\n    }\n\n    this.beat++;\n    let timerBarPosition = Math.round(graphObject.lowerLimitX + (graphObject.upperLimitX - graphObject.lowerLimitX) / this.beatsPerScreen * (this.beat))\n\n    for (let i = 0; i < this.audioSources.length; i++) {\n      if (graphObject.expressions[i].validity === true && timerBarPosition >= graphObject.expressions[i].domain[0] && timerBarPosition <= graphObject.expressions[i].domain[1] && this.audioSources[i].muteToggle === false) {\n        let newFreq = graphObject.calculate(timerBarPosition, graphObject.expressions[i].expr);\n        this.audioSourcesToPlay.push(this.audioSources[i]);\n        if (newFreq <= -12000) {\n          this.audioSources[i].changeFrequency(-12000);\n\n        }\n        else if (newFreq >= 12000) {\n          this.audioSources[i].changeFrequency(12000);\n\n\n        }\n        else if (isNaN(newFreq) === false) {\n          this.audioSources[i].changeFrequency(newFreq);\n\n\n        }\n\n      }\n    }\n\n\n\n  },\n  MoveTimerBarAndPlay() {\n    timingContext.clearRect(0, 0, graphCanvas.width, graphCanvas.height);\n\n    timingContext.beginPath();\n    timingContext.moveTo(graphCanvas.width / this.beatsPerScreen * this.beat, 0);\n    timingContext.lineTo(graphCanvas.width / this.beatsPerScreen * this.beat, graphCanvas.height);\n    timingContext.stroke();\n\n    for (let i = 0; i < this.audioSourcesToPlay.length; i++) {\n      timingGraphObject.audioSourcesToPlay[i].play();\n    }\n    this.audioSourcesToPlay = [];\n\n\n    this.CalculateNextNote();\n  }\n}\n//#endregion\n\n//#region Audio\n\nlet instrumentList = new Instruments().names.splice(0, 127);\n\nclass audioSource {\n  constructor() {\n\n    this.instrumentNumber = 0; // default\n    this.frequency = 0;\n    this.player = new Instruments();\n    this.muteToggle = false;\n\n\n  }\n  play() {\n    if (this.muteToggle === false) {\n      this.player.play(this.instrumentNumber, this.frequency, 1, 0, 0.5)\n\n\n    }\n\n  }\n  changeFrequency(newFreq) {\n\n    this.frequency = Math.abs(newFreq);\n  }\n  changeMuteToggle(newVal) {\n    this.muteToggle = newVal;\n  }\n  changeInstrument(newInstrumentNumber) {\n\n\n    this.instrumentNumber = newInstrumentNumber;\n  }\n\n\n\n}\n\n//#endregion\n\n//#region React components\nclass AllInputs extends React.Component {\n\n  constructor() {\n    super()\n    this.state = { components: [0] };\n    this.IDCount = 0;\n    this.possibleColourArray = [\"#2F2980\", \"#0476D9\", \"#56DACC\", \"#8C186D\", \"#F23535\", \"#ffffff\"]\n    this.lastColourPicked = 0;\n  }\n  create() {\n    let prevState = this.state.components;\n    this.IDCount++;\n    prevState.push(this.IDCount)\n    graphObject.expressions.push(new expressionConstructor(\"\", [-1000, 1000], this.possibleColourArray[this.lastColourPicked]));\n    if (this.lastColourPicked === 4) {\n      this.lastColourPicked = 0;\n\n    } else {\n      this.lastColourPicked++;\n\n    }\n    timingGraphObject.audioSources.push(new audioSource())\n    this.setState({ components: prevState });\n  }\n\n  delete(id) {\n    let prevState = this.state.components\n    let idIndex = prevState.findIndex(el => el === id);\n    prevState.splice(idIndex, 1);\n    graphObject.expressions.splice(idIndex, 1);\n    timingGraphObject.audioSources.splice(idIndex, 1);\n    this.setState({ components: prevState });\n    graphObject.GraphCalculator();\n  }\n  changeInstrument(id, newInstrumentNumber) {\n    let idIndex = this.state.components.findIndex(el => el === id);\n    timingGraphObject.audioSources[idIndex].changeInstrument(newInstrumentNumber);\n\n  }\n  changeDomain(id, newValue) {\n    let idIndex = this.state.components.findIndex(el => el === id);\n    graphObject.expressions[idIndex].domain = newValue;\n    graphObject.GraphCalculator();\n\n  }\n\n\n  render() {\n    return (\n\n      <InputBox components={this.state.components} deleteFunction={this.delete.bind(this)}\n        createFunction={this.create.bind(this)} changeInstrumentFunction={this.changeInstrument.bind(this)} changeDomainFunction={this.changeDomain.bind(this)}\n      />\n\n\n\n    )\n  }\n\n}\n\nclass InputBox extends React.Component { // where we type in the function and clear\n\n  constructor(props) {\n    super(props)\n    this.handleChangeDomain = this.handleChangeDomain.bind(this);\n    this.handleCreate = this.handleCreate.bind(this);\n    this.handleDeleteFunction = this.handleDelete.bind(this);\n\n\n  }\n  handleCreate(id) {\n    this.props.createFunction(id);\n\n  }\n  handleDelete(id) {\n    this.props.deleteFunction(id);\n  }\n\n  handleChangeDomain(id, newValue) {\n\n    this.props.changeDomainFunction(id, newValue);\n\n  }\n\n\n\n  render() {\n    return (\n      <div>\n        <ListGroup>\n\n          {\n            this.props.components.map(comp =>\n              <ListGroup.Item className=\"ListGroupItem\" key={comp}>\n                <div >\n                  <Input components={this.props.components} id={comp} deleteFunction={this.handleDeleteFunction} />\n                  {\n                    <ReactSlider\n                      defaultValue={[-1000, 1000]}\n                      max={1000}\n                      min={-1000}\n                      renderThumb={(props, state) => <div {...props}>{state.valueNow}</div>}\n                      onAfterChange={val => { this.handleChangeDomain(comp, val); }}\n                      className=\"horizontal-slider-twohandle\"\n                      thumbClassName=\"sliderThumbTwoHandle\"\n                      trackClassName=\"sliderTrack\"\n                      pearling={true}\n\n                    />\n                  }\n                  <InstrumentChooser id={comp} changeInstrumentFunction={this.props.changeInstrumentFunction} />\n\n                </div>\n              </ListGroup.Item>\n\n            )\n\n          }\n        </ListGroup>\n        <Button className=\"newFunctionButton\" variant=\"dark\" onClick={this.handleCreate.bind(this)}>{<i className=\"fa fa-plus\" aria-hidden=\"true\"></i>}</Button>\n\n        <Accordion className=\"HelpAccordion\">\n          <Card>\n            <Card.Header>\n              <Accordion.Toggle as={Button} variant=\"dark\" eventKey=\"0\" className=\"HelpButton\">\n                About\n              </Accordion.Toggle>\n            </Card.Header>\n            <Accordion.Collapse eventKey=\"0\">\n              <Card.Body>\n                To make sounds, enter in any function with x as the only variable, like sin(x)*50 or x^3+x+24 or 400/x. A sound will be made where the vertical counting bar crosses any function.\n                <br />\n                <br />\n                The frequency of the sound will be the y value of the intersection of the function and vertical bar, this means that higher values will work better e.g sin(x)*50 rather than sin(x).\n                The Beats Per Screen slider at the top of screen amount of times the vertical bar will occur per screen.\n                The Time Per Beat slider controls the time between the vertical bar moving.\n                You can adjust the domain of the function with its slider below it, along with its instrument.\n                You can add as many functions as you like, click the plus button to create a new one, and the x button to delete one graph.\n                <br />\n                <br />\n\n                Just play around with it! Pick whatever instrument sounds interesting, fiddle around with the sliders\n                and make something that sounds cool!\n                <br />\n\n              </Card.Body>\n            </Accordion.Collapse>\n\n          </Card>\n\n        </Accordion>\n      </div >\n\n    )\n  }\n\n}\nclass InstrumentChooser extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleChange = this.handleChange.bind(this);\n\n  }\n  handleChange() {\n\n    let newAudioType = document.getElementById(this.props.id + \"audioType\").value;\n    this.props.changeInstrumentFunction(this.props.id, newAudioType);\n\n  }\n  render() {\n    return (\n      <Form.Control as=\"select\" onChange={this.handleChange} id={this.props.id + \"audioType\"}>\n        {\n          instrumentList.map((name, index) => {\n\n            return <option key={index} value={index}>{name}</option>\n\n          })\n        }\n      </Form.Control>\n\n\n\n    )\n  }\n\n}\n\nclass Input extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { text: \"\" };\n\n    this.handleChange = this.handleChange.bind(this);\n    this.idIndex = this.props.components.findIndex(el => el === this.props.id);\n    this.colour = graphObject.expressions[this.idIndex].colour;\n    this.validity = false;\n\n  }\n\n  handleChange(e) {\n\n    this.idIndex =this.props.components.findIndex(el => el === this.props.id);\n    this.setState({ text: e.target.value });\n\n\n    graphObject.expressions[this.idIndex].expr = e.target.value.toLowerCase();\n    graphObject.expressions[this.idIndex].validity = false;\n    this.validity = false;\n    if (e.target.value === \"\") {\n      graphObject.expressions[this.idIndex].expr = \"\";\n      graphObject.expressions[this.idIndex].validity = false;\n      this.validity = false;\n      graphObject.GraphCalculator();\n    }\n    else if (graphObject.ExpressionValidifier(graphObject.expressions[this.idIndex].expr, this.idIndex) === true) {\n      graphObject.expressions[this.idIndex].validity = true;\n      this.validity = true;\n      graphObject.GraphCalculator();\n    }\n\n\n  }\n\n\n\n  render() {\n    return (\n      <InputGroup>\n        <InputGroup.Prepend>\n          <InputGroup.Text className=\"colourIndicator\" style={{ backgroundColor: this.colour }}> </InputGroup.Text>\n        </InputGroup.Prepend>\n        <Form.Control\n          className=\"Input\"\n          isInvalid={!this.validity}\n          placeholder=\"Enter function e.g 3x + 70\"\n          type=\"text\"\n          value={this.state.text}\n          onChange={this.handleChange}\n        />\n\n        <MuteButton id={this.props.id} components={this.props.components} />\n\n        <DeleteButton id={this.props.id} deleteFunction={this.props.deleteFunction} />\n\n      </InputGroup >\n\n\n    )\n  }\n}\nclass DeleteButton extends React.Component {\n  constructor(props) {\n    super(props)\n    this.handleClick = this.handleClick.bind(this);\n  }\n  handleClick() {\n    this.props.deleteFunction(this.props.id);\n  }\n  render() {\n    return (\n\n      <InputGroup.Append>\n\n        <Button variant=\"outline-dark\" onClick={this.handleClick}>{<i className=\"fa fa-times\" aria-hidden=\"true\"></i>}</Button>\n\n      </InputGroup.Append>\n\n\n    )\n  }\n\n}\nclass MuteButton extends React.Component {\n  constructor(props) {\n    super(props)\n    this.handleChange = this.handleChange.bind(this)\n    this.state = { iconToShow: \"fas fa-volume-up\", isMuted: false };\n\n\n  }\n\n\n  handleChange() {\n    let idIndex = this.props.components.findIndex(el => el === this.props.id);\n\n    if (this.state.isMuted === true) {\n      timingGraphObject.audioSources[idIndex].changeMuteToggle(false) // not muted\n      this.setState({ iconToShow: \"fas fa-volume-up\", isMuted: false });\n    }\n    else {\n      timingGraphObject.audioSources[idIndex].changeMuteToggle(true) // muted\n      this.setState({ iconToShow: \"fas fa-volume-mute\", isMuted: true });\n\n    }\n\n  }\n\n  render() {\n    return (\n\n\n      <InputGroup.Append>\n\n\n        <Button\n          variant=\"outline-dark\"\n\n\n          onClick={this.handleChange}\n        >\n          {<i className={this.state.iconToShow}></i>}\n        </Button>\n\n\n\n      </InputGroup.Append>\n\n\n    )\n  }\n\n}\n\n\n\nclass BPS extends React.Component {\n\n  constructor() {\n    super()\n    this.handleChangeBPS = this.handleChangeBPS.bind(this);\n    this.state = { value: 50 };\n\n  }\n\n  handleChangeBPS(newVal) {\n    this.setState({ value: newVal });\n    timingGraphObject.beatsPerScreen = newVal;\n\n  }\n\n\n  render() {\n    return (\n\n      <Form>\n        <Form.Group className=\"Slider\">\n          <Form.Label className=\"label\">Beats Per Screen</Form.Label>\n\n\n          <ReactSlider\n            defaultValue={this.state.value}\n            max={100}\n            min={1}\n            renderThumb={(props, state) => <div {...props}>{state.value}</div>}\n            onChange={val => { this.handleChangeBPS(val); }}\n            className=\"horizontal-slider-onehandle\"\n            thumbClassName=\"sliderThumb\"\n            trackClassName=\"sliderTrack\"\n\n\n          />\n\n        </Form.Group>\n\n      </Form>\n\n\n    )\n  }\n\n}\nclass TBB extends React.Component {\n\n  constructor() {\n    super()\n\n    this.handleChangeTBB = this.handleChangeTBB.bind(this);\n    this.state = { value: 500 };\n  }\n\n  handleChangeTBB(newVal) {\n    this.setState({ value: newVal });\n    timingGraphObject.timeBetweenBeats = newVal;\n\n  }\n\n  render() {\n    return (\n\n      <Form>\n        <Form.Group className=\"Slider\">\n          <Form.Label className=\"label\">Time Between Beats</Form.Label>\n\n          <ReactSlider\n            defaultValue={this.state.value}\n            max={1000}\n            min={100}\n            renderThumb={(props, state) => <div {...props}>{state.value / 1000 + \"s\"}</div>}\n            onChange={val => { this.handleChangeTBB(val); }}\n            className=\"horizontal-slider-onehandle\"\n            step={100}\n            thumbClassName=\"sliderThumb\"\n            trackClassName=\"sliderTrack\"\n\n\n          />\n        </Form.Group>\n\n      </Form>\n\n\n\n    )\n  }\n\n}\n\nclass Graphs extends React.Component {\n  constructor(props) {\n    super(props);\n    this.graphCanvasRef = React.createRef();\n    this.timingCanvasRef = React.createRef();\n    this.windowWidth = window.innerWidth;\n    this.dragCoords = {\n      x: 0,\n      y: 0\n    };\n    this.pointerEventArray = [];\n    this.prevPointDist = -1;\n    this.dragging = false\n    this.timesPerSecond = 60;\n    this.waiting = false;\n\n    this.handleMouseDown = this.handleMouseDown.bind(this);\n    this.handleMouseMove = this.handleMouseMove.bind(this);\n    this.handleMouseUp = this.handleMouseUp.bind(this);\n    this.handleMouseOut = this.handleMouseOut.bind(this);\n    this.handleWheel = this.handleWheel.bind(this);\n    this.handleResize = this.handleResize.bind(this);\n    this.handleMouseEnter = this.handleMouseEnter.bind(this);\n\n\n\n  }\n  componentDidMount() {\n    graphCanvas = this.graphCanvasRef.current;\n    graphContext = this.graphCanvasRef.current.getContext('2d');\n\n    timingCanvas = this.timingCanvasRef.current;\n    timingContext = this.timingCanvasRef.current.getContext('2d');\n\n    window.addEventListener(\"resize\", this.handleResize)\n\n  }\n  preventDefault(e) {\n    e.returnValue = false;\n  }\n  handleMouseEnter() {\n    document.addEventListener('wheel', this.preventDefault, {\n      passive: false,\n    })\n  }\n  handleMouseDown(e) {\n    e.persist();\n    this.pointerEventArray.push(e);\n    this.dragging = true;\n    this.dragCoords = {\n      x: e.clientX,\n      y: e.clientY\n    }\n  }\n  handleMouseMove(e) {\n\n    if (this.waiting === false && this.dragging === true) { // throttling\n\n\n      e.persist();\n      for (let i = 0; i < this.pointerEventArray.length; i++) { // for handling a pinch gesture\n        if (e.pointerId === this.pointerEventArray[i].pointerId) {\n          this.pointerEventArray[i] = e;\n\n          break;\n        }\n      }\n\n      if (this.pointerEventArray.length === 2) {\n        let curPointDist = Math.hypot(this.pointerEventArray[0].clientX - this.pointerEventArray[1].clientX, this.pointerEventArray[0].clientY - this.pointerEventArray[1].clientY);\n        if (this.prevPointDist > 0) {\n          if (curPointDist > this.prevPointDist) {\n\n            graphObject.Scale(0.9);\n\n          }\n          else if (curPointDist < this.prevPointDist) {\n\n            graphObject.Scale(1.1);\n\n          }\n        }\n\n\n        this.prevPointDist = curPointDist;\n        return;\n\n      }\n\n      if (this.dragging === true) {\n        graphObject.ShiftGraph(e.clientX - this.dragCoords.x, (this.dragCoords.y - e.clientY));\n\n        this.dragCoords = {\n          x: e.clientX,\n          y: e.clientY\n        }\n      }\n\n\n\n      this.waiting = true;\n      setTimeout(function () {\n        this.waiting = false;\n      }.bind(this), 1000 / this.timesPerSecond);\n\n    }\n\n  }\n  handleMouseUp(e) {\n    e.persist();\n    this.pointerEventArray = [];\n    for (let i = 0; i < this.pointerEventArray.length; i++) {\n      if (this.pointerEventArray[i].pointerId === e.pointerId) {\n        this.pointerEventArray.splice(i, 1);\n        break;\n      }\n    }\n\n    if (this.pointerEventArray.length < 2) {\n      this.prevPointDist = -1;\n    }\n\n    this.dragging = false\n\n  }\n  handleMouseOut() {\n    this.dragging = false\n    document.removeEventListener('wheel', this.preventDefault, false)\n  }\n\n\n  handleWheel(e) {\n    if (e.deltaY < 0) {\n      // Zoom in\n\n      graphObject.Scale(0.9);\n    }\n    else {\n      // Zoom out\n      graphObject.Scale(1.1);\n\n    }\n  }\n  handleResize() {\n    if (window.innerWidth !== this.windowWidth) { // makes resize only happen for width changes\n      this.windowWidth = window.innerWidth;\n      if (window.innerWidth < 992) { // if the window less than lg breakpoint\n        graphObject.WindowSizeChange(document.getElementById('graphwrapper').getBoundingClientRect().width, window.innerHeight * 0.5);\n\n      }\n      else {\n        graphObject.WindowSizeChange(window.innerWidth * 0.65, window.innerHeight);\n\n      }\n    }\n\n  }\n\n\n  render() {\n    return (\n\n      <div>\n\n        <canvas ref={this.graphCanvasRef} onPointerDown={this.handleMouseDown} onPointerMove={this.handleMouseMove}\n          onPointerUp={this.handleMouseUp} onPointerOut={this.handleMouseOut} onWheel={this.handleWheel} onPointerEnter={this.handleMouseEnter} className=\"graphCanvas\"> </canvas>\n\n        <canvas ref={this.timingCanvasRef} className=\"timingCanvas\"></canvas>\n\n      </div>\n    )\n  }\n}\nclass App extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    graphObject.expressions = [new expressionConstructor(\"0\", [-1000, 1000], \"#000000\")]; // array of objects that gets all info about a certain expression colour, value and domains.\n    // initialised here so component in charge of displaying colour will know what's going on\n\n  }\n  componentDidMount() {\n    graphObject.Setup();\n    graphObject.DrawAxes();\n    timingGraphObject.Setup();\n  }\n  render() {\n\n\n    return (\n\n      <div>\n        <Container fluid className=\"bg\">\n          <Nav fill className=\"topbar \">\n\n            <Nav.Item>\n\n              <BPS />\n\n            </Nav.Item>\n            <Nav.Item>\n\n              <TBB />\n\n            </Nav.Item>\n\n          </Nav>\n\n          <Row>\n            <Col xs={12} lg={{ span: 4, order: 'first' }}>\n\n\n              <AllInputs />\n\n\n            </Col>\n\n            <Col xs={{ span: 12, order: 'first' }} lg={8} className=\"graphColumn\">\n              <div id=\"graphwrapper\">\n                <Graphs />\n\n              </div>\n\n            </Col>\n\n\n          </Row>\n\n\n\n        </Container>\n\n\n      </div >\n    )\n  }\n}\n\n\n\n\n\n\n\n\n//#endregion\n\nexport default App;"]},"metadata":{},"sourceType":"module"}